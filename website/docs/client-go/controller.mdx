---
sidebar_position: 2
---
import GithubSVG from '@site/static/img/github-mark.svg';
import KubernetesSVG from '@site/static/img/kubernetes-mark.svg';
import WatchRequestSVG from '@site/static/img/watch-request.svg';
import StreamWatcherSVG from '@site/static/img/streamwatcher.svg';


# controller
åœ¨æ­£å¼ä»‹ç»controllerä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦é¢„å…ˆçŸ¥é“ä¸€äº›ä¸ä¹‹æœ‰å…³çš„è¾…åŠ©æ¦‚å¿µã€‚

## Kuberneteså¯¹è±¡çš„æœŸæœ›çŠ¶æ€ä¸å®é™…çŠ¶æ€

æ ¹æ®Kubernetesèµ„æºç®¡ç†çš„è®¾è®¡æ–‡æ¡£[Resource Management <GithubSVG />](https://github.com/kubernetes/design-proposals-archive/blob/main/architecture/resource-management.md)ï¼ŒKubernetesè¢«è®¾è®¡æˆä¸€ä¸ª*å£°æ˜å¼èµ„æºç®¡ç†ç³»ç»Ÿï¼ˆdeclarative resource-management systemï¼‰*[^1]ã€‚
è€ŒKubernetes APIä½œä¸ºç³»ç»Ÿå”¯ä¸€çš„å¯¹å¤–äº¤äº’æ¥å£ä¹Ÿå› æ­¤éœ€è¦æ”¯æŒå¯¹èµ„æºçš„*å£°æ˜å¼é…ç½®*ã€‚
æ‰€è°“èµ„æºçš„*å£°æ˜å¼é…ç½®*æ˜¯æŒ‡ç”¨æˆ·å‘Kubernetes APIä»…æè¿°èµ„æºçš„æœŸæœ›çŠ¶æ€ï¼Œç”±ç³»ç»Ÿæ¥æ§åˆ¶ä»¥ä½¿èµ„æºè¾¾åˆ°æœŸæœ›çŠ¶æ€ã€‚
åŒæ—¶ï¼Œæ ¹æ®[Kubernetes API Conventions <GithubSVG/>](https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status)ï¼ŒKuberneteså¯¹è±¡çš„*æœŸæœ›çŠ¶æ€*éœ€è¦æ”¾åœ¨åä¸º`spec`çš„å­—æ®µä¸­ã€‚ä½œä¸ºåŒºåˆ†ï¼Œç³»ç»Ÿè§‚æµ‹åˆ°èµ„æºçš„*å®é™…çŠ¶æ€*åˆ™è¦æ”¾åœ¨åä¸º`status`çš„å­—æ®µä¸­ã€‚[ğŸˆ](../intro#çº¦å®š)

æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è®¤ä¸ºKuberneteså¯¹è±¡çš„*æœŸæœ›çŠ¶æ€*å°±æ˜¯æŒ‡èµ„æº`spec`å­—æ®µæè¿°çš„å†…å®¹ï¼Œè€ŒKuberneteså¯¹è±¡çš„*å®é™…çŠ¶æ€*åˆ™æ˜¯æŒ‡èµ„æº`status`è®°å½•çš„å†…å®¹ã€‚

## åè°ƒï¼ˆreconcileï¼‰
åœ¨Kubernetesä¸­ï¼Œ*åè°ƒï¼ˆreconcileï¼‰*æ˜¯ä½¿Kuberneteså¯¹è±¡çš„æœŸæœ›çŠ¶æ€ä¸å®é™…çŠ¶æ€ä¿æŒä¸€è‡´çš„è¿‡ç¨‹ã€‚


## æ§åˆ¶å™¨ï¼ˆcontrollerï¼‰

åœ¨Kubernetesä¸­ï¼Œ *æ§åˆ¶å™¨ï¼ˆcontrollerï¼‰*æ˜¯æŒ‡ç”¨äº*åè°ƒ*çš„æ— é™å¾ªç¯[^2][^3]ã€‚
å¦å¤–ï¼Œæ ¹æ®æ–‡æ¡£[Resource Management GithubSVG](https://github.com/kubernetes/design-proposals-archive/blob/main/architecture/resource-management.md#declarative-control)ä¸­çš„å™è¿°ï¼Œ
æ§åˆ¶å™¨**åªèƒ½**é€šè¿‡ä¸Kubernetes APIäº¤äº’æ¥å®æ–½åè°ƒåŠ¨ä½œï¼Œè€Œä¸èƒ½ç›´æ¥è®¿é—®çŠ¶æ€é›†ç¾¤çš„å­˜å‚¨ï¼ˆetcdï¼‰æˆ–è€…å…¶ä»–ç§æœ‰çš„æœåŠ¡[^5]ã€‚

Kubernetesé›†ç¾¤å†…ç½®äº†ä¸€äº›åŸç”Ÿèµ„æºçš„æ§åˆ¶å™¨ï¼Œä¾‹å¦‚Jobæ§åˆ¶å™¨ç­‰ã€‚
å½“ç”¨æˆ·å£°æ˜ä¸€ä¸ªjobèµ„æºåï¼Œå®ƒçš„æœŸæœ›çŠ¶æ€å¯ä»¥ç†è§£æˆ"å·²å®Œæˆï¼ˆCompletedï¼‰"ã€‚
Jobæ§åˆ¶å™¨æœ¬èº«å¹¶ä¸åˆ›å»ºpodèµ„æºæ¥æ‰§è¡Œä»»åŠ¡ï¼Œå®ƒä¹Ÿæ˜¯é€šè¿‡Kubernetes APIæ¥åˆ›å»ºpodèµ„æºæ¥è¿è¡Œä»»åŠ¡[^4]ï¼Œå¹¶ç¡®ä¿è¯¥jobèµ„æºè¾¾åˆ°å®ƒçš„æœŸæœ›çŠ¶æ€"å·²å®Œæˆ"ã€‚


:::tip
å› æ­¤æ—¢ç„¶èµ„æºæ§åˆ¶å™¨åªèƒ½ä¸Kubernetes APIäº¤äº’ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è®¤ä¸ºæ§åˆ¶å™¨æ˜¯ä¸€ç§å…·æœ‰ç‰¹æ®Šè¡Œä¸ºçš„èµ„æºå®¢æˆ·ç«¯ã€‚
:::

## Kuberneteså¯¹è±¡å­èµ„æºstatus
åœ¨ä¹‹å‰[å­èµ„æºï¼ˆsubresourceï¼‰](../apimachinery/kubernetes-api#å­èµ„æºsubresource)ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†*å­èµ„æº*çš„æ¦‚å¿µã€‚åœ¨å½“æ—¶ç”±äºç¼ºä¹æœŸæœ›çŠ¶æ€ï¼Œå®é™…çŠ¶æ€å’Œæ§åˆ¶å™¨çš„é¢„å¤‡çŸ¥è¯†ï¼Œè¿˜ä¸é€‚åˆå¼•å…¥`status`å­èµ„æºçš„æ¦‚å¿µã€‚ä¸‹é¢æˆ‘ä»¬æ­£å¼ä»‹ç»Kubernetes APIä¸­è¿™ä¸ªéå¸¸é‡è¦çš„å­èµ„æºã€‚
Kubernetes APIå¼•å…¥`status`å­èµ„æºçš„åŠ¨æœºæ˜¯ä¸ºäº†å°†å¯¹Kuberneteså¯¹è±¡`status`å­—æ®µï¼ˆå®é™…çŠ¶æ€ï¼‰çš„å˜æ›´ä¸`spec`å­—æ®µï¼ˆæœŸæœ›çŠ¶æ€ï¼‰çš„å˜æ›´åˆ†å¼€ï¼š
* ç”¨æˆ·å¯ä»¥å†™å…¥ï¼ˆæˆ–æ›´æ”¹ï¼‰èµ„æºçš„`spec`ï¼ˆæœŸæœ›çŠ¶æ€ï¼‰ï¼Œä½†ä¸åº”æ›´æ”¹èµ„æºçš„`status`å­—æ®µï¼›
* æ§åˆ¶å™¨å¯ä»¥å†™å…¥ï¼ˆæˆ–æ›´æ”¹ï¼‰`status`å­—æ®µï¼ˆå®é™…çŠ¶æ€ï¼‰ï¼Œä½†ä¸åº”æ›´æ”¹èµ„æºçš„`spec`å­—æ®µã€‚
é€šè¿‡æ™®é€šèµ„æºAPIåˆ›å»ºæˆ–è€…æ›´æ”¹èµ„æºæ—¶ï¼Œ`kube-apiserver`ä¼šè‡ªåŠ¨å¿½ç•¥è¯·æ±‚ä½“ä¸­`status`å­—æ®µä¸­çš„å†…å®¹ï¼›é€šè¿‡å­èµ„æº`status`APIæ›´æ–°èµ„æºçŠ¶æ€æ—¶ï¼Œ`kube-apiserver`ä¹Ÿä¼šå¿½ç•¥è¯·æ±‚ä½“ä¸­`status`å­—æ®µä¹‹å¤–çš„æ›´æ”¹ã€‚
é™¤æ­¤ä»¥å¤–ï¼ŒKubernetesæ”¯æŒä½¿ç”¨ç‹¬ç«‹çš„RBACè§„åˆ™å•ç‹¬æ§åˆ¶å­èµ„æºè®¿é—®æƒé™ï¼Œä¾‹å¦‚ï¼š
```yaml
apiVersion: rbac.authorization.k8s.io/v1
   kind: Role
metadata:
   # ...
   rules:
   - apiGroups: [""]
     resources: ["pods/status"]
     verbs: ["update", "patch"]
```
é€šè¿‡è¿™ç§æ›´ç»†ç²’åº¦çš„APIè®¿é—®æƒé™æ§åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥è®©æ§åˆ¶å™¨ä»…è·å¾—å­èµ„æº`status`çš„å†™æƒé™ï¼ŒåŒæ ·æˆ‘ä»¬ä¹Ÿå¯ä»¥æ”¶æ•›ç”¨æˆ·çš„æƒé™ä»¥é¿å…ç”¨æˆ·é€šè¿‡å­èµ„æº`status`APIä¿®æ”¹èµ„æºçš„å®é™…çŠ¶æ€ã€‚

å¦å¤–ï¼Œå¯¹äºè‡ªå®šä¹‰èµ„æºï¼ˆCRï¼‰ï¼Œéœ€è¦é€šè¿‡åœ¨CRDä¸­å£°æ˜æ‰èƒ½å¼€å¯`status`å­èµ„æºAPIï¼š
```yaml
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
spec:
  subresources:
    status: {}
# ...
```
      
## æ§åˆ¶å™¨æ¨¡å¼

æ ¹æ®ä¸Šæ–‡ä¸­æ§åˆ¶å™¨çš„å®šä¹‰ï¼Œä¸‹é¢çš„ä¼ªä»£ç æè¿°äº†ä¸€ç§æœ€ä¸ºç®€å•åŸºç¡€çš„æ§åˆ¶å™¨å®ç°ï¼š
```go
for {
  desired := getDesiredState()
  current := getCurrentState()
  makeChanges(desired, current)
}
```
Kuberneteså„ç§æ§åˆ¶å™¨çš„å®ç°æœ¬è´¨ä¸Šéƒ½æ˜¯å¯¹æ­¤åŸºæœ¬æ¡†æ¶çš„ä¼˜åŒ–å’Œæ‰©å±•ã€‚


## è¢«é—å¿˜çš„ç›‘å¬ï¼ˆwatchï¼‰æœºåˆ¶
åœ¨ä¸Šè¿°çš„ç»“æ„ä¸­ï¼Œç›¸æ¯”äºé€šè¿‡è½®è¯¢ä¸æ–­ä¸»åŠ¨è·å–èµ„æºçš„çŠ¶æ€ï¼Œ ä¸€ä¸ªæ˜æ˜¾å¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹æ˜¯æˆ‘ä»¬å¯ä»¥**è¢«åŠ¨åœ°**åªåœ¨**æœ‰å¯¹è±¡çŠ¶æ€å‘ç”Ÿå˜æ›´çš„æ—¶å€™**æ‰è§¦å‘åè°ƒåŠ¨ä½œã€‚
åŸå› ä¹Ÿå¾ˆç®€å•ï¼Œåªæœ‰å½“å¯¹è±¡çŠ¶æ€å‘ç”Ÿå˜æ›´çš„æ—¶å€™ï¼Œæ‰æœ‰å¯èƒ½ä¸æœŸæœ›çš„çŠ¶æ€å‘ç”Ÿåç¦»ï¼Œå› æ­¤æˆ‘ä»¬åªè¦åœ¨æ­¤æ—¶åˆ»è§¦å‘åè°ƒåŠ¨ä½œå³å¯ã€‚

å¹¸è¿çš„æ˜¯ï¼Œ Kubernetes APIæ”¯æŒæŒç»­*ç›‘å¬ï¼ˆwatchï¼‰*èµ„æºçš„å˜æ›´ï¼ˆåŒ…æ‹¬*æ–°å¢*ï¼Œ*ä¿®æ”¹*ä»¥åŠ*åˆ é™¤*äº‹ä»¶ï¼‰ã€‚ è¿™äº›å˜æ›´äº‹ä»¶åˆ™ä»¥HTTP"æµ"[^5]çš„å½¢å¼è¿”å›ã€‚


### ä½¿ç”¨RESTClientç›‘å¬èµ„æº
æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨`RESTClient`æ¥ç›‘å¬èµ„æºçš„ä¸€ä¸ªä¾‹å­ï¼š
```go
// Assume restClient is initialized.
opts := metav1.ListOptions{}
opts.Watch = true
watcher, _ = restClient.
        Get().
        Namespace("ns").
        Resource("pods").
        VersionedParams(&opts, scheme.ParameterCodec).
        Watch()

for event := range watcher.ResultChan() {
    fmt.Printf("Event type: %v\n", event.Type)
    fmt.Printf("Pod name: %v\n", event.Object.(*v1.Pod).Name)
}
```
* é¦–å…ˆæˆ‘ä»¬éœ€è¦å°†`metav1.ListOptions`å¯¹è±¡çš„`Watch`æˆå‘˜è®¾ç½®ä¸º`true`ã€‚`metav1.ListOptions`å¯¹è±¡å°†æœ€ç»ˆä¼šè¢«`scheme.ParameterCodec`ç¼–ç æˆè¯·æ±‚URLä¸­çš„`?watch=true`éƒ¨åˆ†ã€‚
* `Watch()`æ–¹æ³•è¿”å›çš„ä¸€ä¸ªæ˜¯`StreamWatcher`å¯¹è±¡ã€‚`StreamWatcher`å¯¹è±¡ä¸æ–­å°†åŸºäºè¿”å›ä½“ä¸­çš„æ•°æ®å—è§£ç æˆ`WatchEvent`å¯¹è±¡[^6]ï¼Œå¹¶å†™å…¥channelä¸­ï¼ˆ`ResultChan`æˆå‘˜ï¼‰ã€‚

<WatchRequestSVG style={{width: "95%"}}/>

<StreamWatcherSVG style={{height: "320px"}}/>


è‡³æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸Šè¿°æ§åˆ¶å™¨åŸºç¡€ç‰ˆä¼ªä»£ç ä¼˜åŒ–ä¸ºï¼š
```go
for event := range eventChannel {
  desired := getDesiredState()
  current := getCurrentState()
  makeChanges(desired, current)
}
```

ç„¶è€Œï¼ŒKubernetes API æä¾›çš„watchæœºåˆ¶è®©æˆ‘ä»¬ç›‘å¬æŸä¸€ç§èµ„æºç±»å‹çš„æ‰€æœ‰å˜æ›´äº‹ä»¶ï¼Œè¿™ä»…ä»…æœ‰åŠ©äºæˆ‘ä»¬ä¼˜åŒ–è§¦å‘åè°ƒåŠ¨ä½œçš„æ—¶æœºã€‚
åè°ƒåŠ¨ä½œæœ¬èº«ä»ç„¶è¦æ±‚æˆ‘ä»¬èƒ½å¤Ÿæœ‰èƒ½åŠ›æ£€ç´¢æ­¤åˆ»æŸç§ï¼ˆæˆ–è€…å¤šç§[^7]ï¼‰èµ„æºç±»å‹çš„æœŸæœ›çŠ¶æ€ä¸å®é™…çŠ¶æ€ã€‚
ä¸€ç§ç®€å•ç›´æ¥çš„æ–¹å¼æ˜¯é€šè¿‡Kubernetes APIæ¥è·å–æ­¤åˆ»èµ„æºçš„é›†åˆï¼š
```go
for event := range eventChannel {

  resources := getResourceListFromK8sAPI()

  for resource := range resources {
   makeChanges(resource.desired, resource.current)
  }

}
```
ç„¶è€Œè¿™å…¶å®å¹¶ä¸æ˜¯ä¸€ç§å¥½çš„åŠæ³•ã€‚
ä¸€æ–¹é¢ï¼Œé€šè¿‡APIæ£€ç´¢èµ„æºé›†åˆæœ¬èº«å¹¶ä¸é«˜æ•ˆ[^8]ã€‚å¦ä¸€æ–¹é¢ï¼Œåœ¨æ§åˆ¶å™¨ä¸­ï¼Œåè°ƒæ˜¯æ§åˆ¶å™¨ä¸­é¢‘ç¹å‘ç”Ÿçš„åŠ¨ä½œã€‚
é‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•ç»§ç»­ä¼˜åŒ–å‘¢ï¼Ÿ

æˆ‘ä»¬ä¸å¦¨æ¢ä¸€ç§æ€è·¯ï¼ŒKubernetes APIçš„watchæœºåˆ¶ä¸ä»…ä»…å¯ä»¥è®©æˆ‘ä»¬æœ‰ç›‘å¬èµ„æºå˜æ›´çš„èƒ½åŠ›ï¼Œæˆ‘ä»¬ç†è®ºä¸Šæ˜¯ä¹Ÿå¯ä»¥**åˆ©ç”¨watchæœºåˆ¶æœ¬èº«åœ¨æœ¬åœ°ç»´æŠ¤ä¸€å¥—èµ„æºå½“å‰çš„æœ€æ–°å‰¯æœ¬**â€”â€”èµ„æºæœ€æ–°çš„çŠ¶æ€å…¶å®ç­‰åŒäºè¯¥èµ„æºæœ€æ–°çš„äº‹ä»¶ã€‚

### ä»Kubernetes watchæœºåˆ¶åˆ°Informer

å¹¸è¿çš„æ˜¯åœ¨`client-go`ä¸­ï¼Œå®˜æ–¹å¼€å‘è€…å·²ç»ä¸ºæˆ‘ä»¬å®ç°äº†**åŸºäºwatchæœºåˆ¶çš„æœ¬åœ°èµ„æºç¼“å­˜æœºåˆ¶**â€”â€”`Informer`ç»„ä»¶ã€‚å®ƒè®¾è®¡çš„åˆè¡·æ—¨åœ¨è®©å¼€å‘è€…å°½é‡é¿å…ç›´æ¥é€šè¿‡Kubernetes APIæ£€ç´¢èµ„æºé›†åˆä»è€Œè¾¾åˆ°å‡è½»KubernetesæœåŠ¡ç«¯å‹åŠ›çš„ç›®çš„ã€‚
å½“ç„¶ï¼Œå®ƒä¹Ÿå®Œç¾å¥‘åˆäº†æˆ‘ä»¬å¯¹äºæ§åˆ¶å™¨çš„éœ€æ±‚ï¼š
1. èµ„æºå˜æ›´äº‹ä»¶çš„é€šçŸ¥ï¼›
2. æœ¬åœ°èµ„æºçš„ç¼“å­˜ã€‚


[^1]: *å£°æ˜å¼ç³»ç»Ÿ*å…¶å®æ˜¯ä¸€ä¸ªä¸*å‘½ä»¤å¼ï¼ˆimperativeï¼‰ç³»ç»Ÿ*ç›¸å¯¹çš„æ¦‚å¿µã€‚åœ¨å‘½ä»¤å¼ç³»ç»Ÿä¸­ï¼Œç”±ç”¨æˆ·æä¾›å¦‚ä½•ä½¿ç³»ç»Ÿè¾¾åˆ°æœŸæœ›çŠ¶æ€çš„å…·ä½“å‘½ä»¤åºåˆ—æˆ–æ­¥éª¤ã€‚
[^2]: è¿™ä¸ªè§£é‡Šå…¶å®æ˜¯æ•´åˆäº†å®˜æ–¹æ–‡æ¡£ä¸­ä¸¤ä¸ªå¯¹æ§åˆ¶å™¨çš„æè¿°ï¼š[Controllers <KubernetesSVG />](https://kubernetes.io/docs/concepts/architecture/controller/)ä»¥åŠ[Writing Controllers <GithubSVG />](https://github.com/kubernetes/community/blob/master/contributors/devel/sig-api-machinery/controllers.md#writing-controllers)
[^3]: Kubernetesæ§åˆ¶å™¨å…¶å®å€Ÿç”¨äº†è‡ªåŠ¨åŒ–ä¸­*[closed-loop controller](https://en.wikipedia.org/wiki/Closed-loop_controller)*è¿™ä¸ªæ¦‚å¿µã€‚åœ¨è‡ªåŠ¨åŒ–é‡Œï¼Œclosed-loop controllerä½¿ç”¨åé¦ˆæ¥æ§åˆ¶åŠ¨æ€ç³»ç»Ÿçš„çŠ¶æ€æˆ–è¾“å‡ºã€‚å®ƒä»¬åœ¨æœ¬è´¨ä¸Šæ˜¯ç›¸é€šçš„ã€‚
[^4]: åœ¨Kubernetesç³»ç»Ÿä¸­ï¼ŒçœŸæ­£åˆ›å»ºpodèµ„æºçš„åŠ¨ä½œç”±kubeletç»„ä»¶å®Œæˆã€‚
[^5]: æ‰€è°“HTTP"æµ"æŒ‡çš„æ˜¯HTTP 1.1çš„*åˆ†å—ä¼ è¾“ç¼–ç *ï¼ˆ[HTTP/1.1 Chunked Transfer Coding](https://en.wikipedia.org/wiki/Chunked_transfer_encoding)ï¼‰ã€‚
      å…·ä½“æ¥è¯´ï¼Œå¯¹èµ„æºç›‘å¬çš„APIæ˜¯åœ¨åŸæœ‰GETè¯·æ±‚çš„åŸºç¡€ä¸Šé¢å¤–å†åŠ ä¸Š`?watch=true`çš„æŸ¥è¯¢å‚æ•°ï¼ˆquery parameterï¼‰ã€‚`kube-apiserver`ä¼šåœ¨è¿”å›çš„å¤´ï¼ˆheaderï¼‰ä¸­
      è®¾ç½®`Transfer-Encoding`ä¸º`chunked`ï¼Œè¡¨ç¤ºé‡‡ç”¨åˆ†å—ä¼ è¾“ç¼–ç ï¼Œå®¢æˆ·ç«¯æ¯è¯»å®Œä¸€ä¸ªæ•°æ®å—ï¼ˆå³èµ„æºçš„å˜æ›´äº‹ä»¶ï¼‰åï¼Œä¼šç»§ç»­è¯»å–æˆ–ç­‰å¾…ä¸‹ä¸€ä¸ªæ•°æ®å—ï¼Œç›´åˆ°å®¢æˆ·ç«¯ä¸»åŠ¨ç»ˆæ­¢è¿æ¥æˆ–è€…è¯»åˆ°é•¿åº¦ä¸º0çš„æ•°æ®åˆ†å—ä¸ºæ­¢ã€‚
      æ¯ä¸ªæ•°æ®å—ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯ä»¥åå…­è¿›åˆ¶å½¢å¼è¡¨ç¤ºçš„åˆ†å—é•¿åº¦ï¼Œåé¢ç´§è·Ÿç€ `\r\n`ä»¥å‘ŠçŸ¥å®¢æˆ·ç«¯åˆ†å—çš„å¤§å°ã€‚ç¬¬äºŒéƒ¨åˆ†æ˜¯åˆ†å—æ•°æ®æœ¬èº«ï¼Œåé¢ä¹Ÿæ˜¯ `\r\n`ï¼Œ ç»ˆæ­¢å—åˆ™æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º0çš„åˆ†å—ã€‚
      ä¾‹å¦‚ï¼š
      ```bash
      GET /api/v1/namespaces/test/pods?watch=1
      ---
      200 OK
      Transfer-Encoding: chunked
      Content-Type: application/json

      {
        "type": "ADDED",
        "object": {"kind": "Pod", "apiVersion": "v1", "metadata": {"resourceVersion": "10596", ...}, ...}
      }
      {
        "type": "MODIFIED",
        "object": {"kind": "Pod", "apiVersion": "v1", "metadata": {"resourceVersion": "11020", ...}, ...}
      }
      ...
      ```
[^6]: `WatchEvent`ç”±äºæ˜¯Kubernetes APIè¿”å›ä½“çš„è§£ç åçš„Goç±»å‹ï¼Œæ‰€ä»¥æ ¹æ®å®šä¹‰ï¼Œå®ƒä»ç„¶æ˜¯kindï¼Œå¹¶ä¸”å±äºkindçš„ç¬¬ä¸‰ç§ç±»ã€‚
[^7]: å¯¹äºå¤æ‚çš„æ§åˆ¶å™¨å¯èƒ½éœ€è¦åŒæ—¶ç®¡ç†`pods`, `services`ï¼Œ`configmaps`ç­‰å¤šç§èµ„æºç±»å‹ã€‚
[^8]: åœ¨å¤§å‹é›†ç¾¤ä¸Šï¼Œæ£€ç´¢æŸäº›èµ„æºç±»å‹çš„é›†åˆå¯èƒ½ä¼šå¯¼è‡´éå¸¸å¤§çš„è¿”å›ï¼Œä»è€Œå½±å“`kube-apiserver`æœåŠ¡å™¨ä»¥åŠå®¢æˆ·ç«¯æ€§èƒ½ã€‚
      ä¾‹å¦‚ï¼Œä¸€ä¸ªé›†ç¾¤å¯èƒ½æœ‰æ•°ä¸‡ä¸ªpodsï¼Œè·¨æ‰€æœ‰å‘½åç©ºé—´æ£€ç´¢æ‰€æœ‰podå¯èƒ½ä¼šå¯¼è‡´éå¸¸å¤§çš„å“åº”å¹¶æ¶ˆè€—å¤§é‡æœåŠ¡å™¨èµ„æºã€‚
      ä¹Ÿå› æ­¤ï¼Œæ ¹æ®[Kubernetes API Concepts <KubernetesSVG />](https://kubernetes.io/docs/reference/using-api/api-concepts/#retrieving-large-results-sets-in-chunks), åœ¨Kubernetes v1.9åï¼Œæ”¯æŒåˆ†å—æ£€ç´¢èµ„æºé›†åˆã€‚








